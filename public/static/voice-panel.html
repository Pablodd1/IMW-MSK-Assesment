<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Control Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/voice-control.css">
</head>
<body class="bg-gray-900 min-h-screen">
    
    <!-- Minimalistic Voice Control Panel (Right Side) -->
    <div class="voice-control-panel" id="voicePanel">
        <!-- Main Voice Button -->
        <button 
            id="voiceBtn" 
            class="voice-btn" 
            aria-label="Voice Commands"
            title="Click or say 'help' for commands"
        >
            <span id="voiceIcon">üé§</span>
            <span class="voice-status-indicator" id="voiceStatus"></span>
        </button>
        
        <!-- Mini Command Buttons -->
        <div class="voice-panel-mini">
            <button 
                class="voice-btn voice-mini-btn" 
                onclick="window.VoiceCommand && window.VoiceCommand.start()"
                title="Start Listening"
            >
                ‚ñ∂Ô∏è
            </button>
            <button 
                class="voice-btn voice-mini-btn" 
                onclick="window.VoiceCommand && window.VoiceCommand.stop()"
                title="Stop Listening"
            >
                ‚èπÔ∏è
            </button>
            <button 
                class="voice-btn voice-mini-btn" 
                onclick="showVoiceHelp()"
                title="Show Commands"
            >
                ‚ùì
            </button>
        </div>
    </div>

    <!-- Voice Feedback Toast -->
    <div class="voice-feedback" id="voiceFeedback">
        Listening...
    </div>

    <!-- Commands Tooltip -->
    <div class="voice-commands-tooltip" id="voiceTooltip">
        <h4>Voice Commands</h4>
        <ul id="commandsList">
            <li>Start recording</li>
            <li>Stop recording</li>
            <li>Analyze movement</li>
            <li>Flip camera</li>
            <li>Show patients</li>
            <li>Generate notes</li>
            <li>Save assessment</li>
            <li>Next / Previous</li>
            <li>Take screenshot</li>
        </ul>
    </div>

    <script src="/static/voice-command.js"></script>
    <script>
        // Initialize voice control when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            const voiceBtn = document.getElementById('voiceBtn')
            const voiceFeedback = document.getElementById('voiceFeedback')
            const voiceTooltip = document.getElementById('voiceTooltip')
            const voiceStatus = document.getElementById('voiceStatus')
            
            // Set up voice command instance
            if (window.VoiceCommand) {
                // Check support
                const status = window.VoiceCommand.getStatus()
                if (status.isSupported) {
                    voiceBtn.classList.add('supported')
                    voiceStatus.classList.add('supported')
                }
                
                // Set feedback elements
                window.VoiceCommand.setFeedbackElement(voiceFeedback)
                window.VoiceCommand.setStatusElement(voiceStatus)
            }
            
            // Main button click handler
            voiceBtn.addEventListener('click', () => {
                if (window.VoiceCommand) {
                    window.VoiceCommand.toggle()
                    
                    const status = window.VoiceCommand.getStatus()
                    if (status.isListening) {
                        voiceBtn.classList.add('listening')
                        document.getElementById('voiceIcon').textContent = 'üîä'
                        voiceFeedback.textContent = 'Listening...'
                        voiceFeedback.classList.add('visible')
                    } else {
                        voiceBtn.classList.remove('listening')
                        document.getElementById('voiceIcon').textContent = 'üé§'
                        voiceFeedback.classList.remove('visible')
                    }
                }
            })
            
            // Long press for continuous listening
            let pressTimer
            voiceBtn.addEventListener('mousedown', () => {
                pressTimer = setTimeout(() => {
                    if (window.VoiceCommand) {
                        window.VoiceCommand.start()
                        voiceBtn.classList.add('listening')
                    }
                }, 500)
            })
            
            voiceBtn.addEventListener('mouseup', () => {
                clearTimeout(pressTimer)
                if (window.VoiceCommand) {
                    window.VoiceCommand.stop()
                    voiceBtn.classList.remove('listening')
                }
            })
            
            // Keyboard shortcut (V key)
            document.addEventListener('keydown', (e) => {
                if (e.key === 'v' && !e.ctrlKey && !e.metaKey) {
                    const active = document.activeElement
                    if (active.tagName !== 'INPUT' && active.tagName !== 'TEXTAREA') {
                        e.preventDefault()
                        voiceBtn.click()
                    }
                }
            })
        })
        
        // Global function to show help
        function showVoiceHelp() {
            const tooltip = document.getElementById('voiceTooltip')
            tooltip.classList.toggle('visible')
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                tooltip.classList.remove('visible')
            }, 10000)
        }
    </script>
</body>
</html>
